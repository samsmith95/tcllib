# -*- tcl -*-
# # ## ### ##### ######## ############# #####################

## Tests for the oo utilities facility
## Copyright (c) 2012 by ActiveState Tool Corp.
## BSD licensed.

# # ## ### ##### ######## ############# #####################

source [file join \
	[file dirname [file dirname [file join [pwd] [info script]]]] \
	devtools testutilities.tcl]

testsNeedTcl     8.5
testsNeedTcltest 2

support {
    testsNeed TclOO 0.6 1

    puts [package ifneeded TclOO [package present TclOO]]
}
testing {
    useLocal ooutil.tcl oo::util
}

# # ## ### ##### ######## ############# #####################

test ooutil-singleton-3609183-1 {bug 3609183} -setup {
    oo::class create example {
	self mixin oo::util::singleton
	method foo {} {self}
    }
} -body {
    set a [[example new] foo]
    set b [[example new] foo]
puts $a
puts $b
    string equal $a $b
} -cleanup {
    unset a b
    example destroy
} -result 1

test ooutil-singleton-3609183-2 {bug 3609183} -setup {
    oo::util::singleton create example {
	method foo {} {self}
    }
} -body {
    set a [[example new] foo]
    set b [[example new] foo]
puts $a
puts $b
    string equal $a $b
} -cleanup {
    unset a b
    example destroy
} -result 1

# # ## ### ##### ######## ############# #####################

testsuiteCleanup
return
